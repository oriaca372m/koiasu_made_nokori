<!doctype html>
<html lang="ja">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

		<link rel="canonical" href="https://oriaca372m.github.io/koiasu_made_nokori/index.html">

		<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js" integrity="sha256-4iQZ6BVL4qNKlQ27TExEhBN1HFPvAvAMbFavKKosSWQ=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/moment-duration-format/2.3.2/moment-duration-format.min.js" integrity="sha256-M2KULKSJyw+G0068JiMlM9GX4XpLdUButSzBqntKDZM=" crossorigin="anonymous"></script>

		<script type="text/javascript">
			"use strict";

			function generate_text(from_moment, to_moment) {
				const diff_duration = moment.duration(to_moment.diff(from_moment));
				if (diff_duration.asMilliseconds() < 0) {
					return '放送開始';
				}
				return diff_duration.format('Y年Mヶ月D日hh時間mm分ss.SS秒', { trim: true });
			}

			const targetTable = new Map([
				['atx', {
					name: 'AT-X',
					time: moment('2020-01-03T20:30:00')
				}],
				['tokyomx', {
					name: 'TOKYO MX',
					time: moment('2020-01-03T23:00:00')
				}],
				['suntv', {
					name: 'サンテレビ',
					time: moment('2020-01-03T24:00:00')
				}],
				['kbskyoto', {
					name: 'KBS京都',
					time: moment('2020-01-03T24:00:00')
				}],
				['tvaichi', {
					name: 'テレビ愛知',
					time: moment('2020-01-11T03:05:00')
				}],
				['bs11', {
					name: 'BS11',
					time: moment('2020-01-03T23:00:00')
				}]
			]);

			let target = 'atx';

			document.addEventListener('DOMContentLoaded', (e) => {
				const display = document.getElementById('time-display');

				const channel = document.getElementById('channel');

				for (const [key, value] of targetTable) {
					const elm = document.createElement('option');
					elm.setAttribute('value', key);
					elm.appendChild(document.createTextNode(value.name));
					channel.appendChild(elm);
				}

				channel.addEventListener('change', (e) => {
					target = e.target.value;
				});

				window.setInterval(() => {
					display.textContent = generate_text(moment(), targetTable.get(target).time);
				}, 10);

				document.getElementById('tweet').addEventListener('click', (e) => {
					const data = targetTable.get(target)
					const msg = `恋する小惑星まで残り ${generate_text(moment(), data.time)} (${data.name})`;
					let url = new URL('https://twitter.com/intent/tweet');
					url.searchParams.append('text', msg)
					url.searchParams.append('url', 'https://oriaca372m.github.io/koiasu_made_nokori/')
					window.open().location.href = (url.toString());
				});
			});
		</script>

		<title>恋する小惑星まで残り</title>
	</head>
	<body>
		<h1>恋する小惑星まで残り</h1>
		<select id="channel" style="font-size: 25px;"></select>
		<p id="time-display" style="font-size: 50px; text-align: center;"></p>
		<button type="button" id="tweet" style="font-size: 25px;">ツイート</button>
	</body>
</html>
